var isCameraAllowed=!1;define ("quizaccess_proctoring/proctoring",["jquery","core/ajax","core/notification"],function(a,b,c){return{setup:function setup(d){if(null!==document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length){return!1}if(null!==document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length){return!1}var e=0,f=!1,g=null;a("#mod_quiz_navblock").append("<div class=\"card-body p-3\"><h3 class=\"no text-left\">Webcam</h3> <br/><video id=\"video\">Video stream not available.</video><canvas id=\"canvas\" style=\"display:none;\"></canvas><div class=\"output\" style=\"display:none;\"><img id=\"photo\" alt=\"The picture will appear in this box.\"/></div></div>");var h=document.getElementById("video"),i=document.getElementById("canvas"),j=document.getElementById("photo"),k=function(){var a=i.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,i.width,i.height);g=i.toDataURL("image/png");j.setAttribute("src",g)},l=function(){var a=i.getContext("2d");if(e){i.width=230;i.height=e;a.drawImage(h,0,0,230,e);g=i.toDataURL("image/png");j.setAttribute("src",g);d.webcampicture=g;var f={courseid:d.courseid,screenshotid:d.id,quizid:d.quizid,webcampicture:g};b.call([{methodname:"quizaccess_proctoring_send_camshot",args:f}])[0].done(function(a){if(!(1>a.warnings.length)){c.addNotification({message:"Something went wrong during taking the image.",type:"error"})}}).fail(c.exception)}else{k()}};navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){h.srcObject=a;h.play();isCameraAllowed=!0}).catch(function(){hideButtons()});if(h){h.addEventListener("canplay",function(){if(!f){e=h.videoHeight/(h.videoWidth/230);if(isNaN(e)){e=230/(4/3)}h.setAttribute("width",230);h.setAttribute("height",e);i.setAttribute("width",230);i.setAttribute("height",e);f=!0}},!1)}else{hideButtons()}h.addEventListener("click",function(a){l();a.preventDefault()},!1);setTimeout(l,3000);setInterval(l,3e4);return!0},init:function init(d){var i=0,j=!1,k=null,l=null,m=null,n=null;function e(){k=document.getElementById("video");l=document.getElementById("canvas");m=document.getElementById("photo");navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){k.srcObject=a;k.play();isCameraAllowed=!0}).catch(function(){c.addNotification({message:"Something went wrong during taking the image.",type:"error"});h()});if(k){k.addEventListener("canplay",function(){if(!j){i=k.videoHeight/(k.videoWidth/320);if(isNaN(i)){i=240}k.setAttribute("width",320);k.setAttribute("height",i);l.setAttribute("width",320);l.setAttribute("height",i);j=!0}},!1)}else{h()}k.addEventListener("click",function(a){g();a.preventDefault()},!1);f()}function f(){if(isCameraAllowed){var a=l.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,l.width,l.height);n=l.toDataURL("image/png");m.setAttribute("src",n)}else{h()}}function g(){var a=l.getContext("2d");if(i){l.width=320;l.height=i;a.drawImage(k,0,0,320,i);n=l.toDataURL("image/png");m.setAttribute("src",n);var e={courseid:d.courseid,screenshotid:d.id,quizid:d.quizid,webcampicture:n};b.call([{methodname:"quizaccess_proctoring_send_camshot",args:e}])[0].done(function(a){if(!(1>a.warnings.length)){c.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}}).fail(c.exception)}else{f()}}function h(){a(".mod_quiz-next-nav").prop("disabled",!0);a(".submitbtns").html("<p class=\"text text-red red\">You need to enable web camera before submitting this quiz!</p>")}e();return n}}});import $ from"jquery";$(function(){$("#id_submitbutton").prop("disabled",!0);$("#id_proctoring").on("change",function(){if(this.checked&&isCameraAllowed){$("#id_submitbutton").prop("disabled",!1)}else{$("#id_submitbutton").prop("disabled",!0)}})});function hideButtons(){$(".mod_quiz-next-nav").prop("disabled",!0);$(".submitbtns").html("<p class=\"text text-red red\">You need to enable web camera before submitting this quiz!</p>")}
//# sourceMappingURL=proctoring.min.js.map
